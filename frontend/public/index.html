<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Live Stream Sentiment Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <script src="/node_modules/chart.js/dist/chart.umd.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>YouTube Live Stream Sentiment Dashboard</h1>
      <p>Track live stream view counts for sentiment analysis</p>
    </header>

    <main>
      <!-- Add Channel Form -->
      <section class="add-channel-section">
        <h2>Add Channel to Track</h2>
        <div class="add-channel-form">
          <input 
            type="text" 
            id="channelHandleInput" 
            placeholder="Enter YouTube channel handle (e.g., @ciidb)"
            aria-label="Channel handle"
          >
          <button id="addChannelBtn" class="btn-primary">
            <span class="btn-text">Add Channel</span>
            <span class="btn-loading" style="display: none;">Adding...</span>
          </button>
        </div>
        <div id="addChannelFeedback" class="feedback-message" style="display: none;"></div>
      </section>

      <!-- Data Collection Section -->
      <section class="collection-section">
        <h2>Collect Historical Data</h2>
        <div class="collection-container">
          <p class="collection-desc">Collect live stream metrics for past dates to build historical data</p>
          <div class="collection-form">
            <div class="date-input-group">
              <label for="collectStartDate">Start Date</label>
              <input type="date" id="collectStartDate" aria-label="Collection start date">
            </div>
            <div class="date-input-group">
              <label for="collectEndDate">End Date</label>
              <input type="date" id="collectEndDate" aria-label="Collection end date">
            </div>
            <button id="collectDataBtn" class="btn-primary">
              <span class="btn-text">Collect Data</span>
              <span class="btn-loading" style="display: none;">Collecting...</span>
            </button>
          </div>
          <div id="collectionFeedback" class="feedback-message" style="display: none;"></div>
        </div>
      </section>

      <!-- Recalculate Data Section -->
      <section class="collection-section recalculate-section">
        <h2>Recalculate Data with Peak Aggregation</h2>
        <div class="collection-container">
          <p class="collection-desc">Re-process existing data to use peak (MAX) view counts instead of sum. Use this to update historical data after the peak view aggregation fix.</p>
          <div class="collection-form">
            <div class="date-input-group">
              <label for="recalcStartDate">Start Date</label>
              <input type="date" id="recalcStartDate" aria-label="Recalculation start date">
            </div>
            <div class="date-input-group">
              <label for="recalcEndDate">End Date</label>
              <input type="date" id="recalcEndDate" aria-label="Recalculation end date">
            </div>
            <button id="recalculateDataBtn" class="btn-secondary">
              <span class="btn-text">Recalculate Data</span>
              <span class="btn-loading" style="display: none;">Recalculating...</span>
            </button>
          </div>
          <div id="recalculationFeedback" class="feedback-message" style="display: none;"></div>
          <div class="recalc-info">
            <strong>‚ÑπÔ∏è Note:</strong> This will re-fetch data from YouTube and recalculate using peak (MAX) aggregation. Days with multiple streams will show the highest view count, not the sum.
          </div>
        </div>
      </section>

      <!-- Filters Section -->
      <section class="filters-section">
        <h2>Filters</h2>
        <div class="filters-container">
          <!-- Channel Selector -->
          <div class="filter-group">
            <label for="channelSelector">Select Channels</label>
            <select id="channelSelector" multiple size="5" aria-label="Channel selector">
              <option value="">Loading channels...</option>
            </select>
            <div class="filter-helper">
              Hold Ctrl/Cmd to select multiple channels for comparison
            </div>
          </div>

          <!-- Date Range Picker -->
          <div class="filter-group">
            <label>Date Range</label>
            <div class="date-presets">
              <button class="preset-btn" data-days="7">Last 7 Days</button>
              <button class="preset-btn" data-days="30">Last 30 Days</button>
              <button class="preset-btn active" data-days="90">Last 90 Days</button>
              <button class="preset-btn" data-days="all">All Time</button>
            </div>
            <div class="date-inputs">
              <div class="date-input-group">
                <label for="startDate">Start Date</label>
                <input type="date" id="startDate" aria-label="Start date">
              </div>
              <div class="date-input-group">
                <label for="endDate">End Date</label>
                <input type="date" id="endDate" aria-label="End date">
              </div>
            </div>
          </div>

          <!-- Apply Filters Button -->
          <div class="filter-actions">
            <button id="applyFiltersBtn" class="btn-primary btn-large">Apply Filters</button>
            <div class="export-dropdown">
              <button id="exportDataBtn" class="btn-secondary btn-large">
                <span>üì• Export Data</span>
                <span class="dropdown-arrow">‚ñº</span>
              </button>
              <div id="exportDropdown" class="dropdown-content" style="display: none;">
                <div class="dropdown-header">Export for AI Analysis</div>
                <button class="dropdown-item" data-format="csv">
                  <span class="dropdown-icon">üìä</span>
                  <span>Download as CSV</span>
                </button>
                <button class="dropdown-item" data-format="json">
                  <span class="dropdown-icon">üìã</span>
                  <span>Download as JSON</span>
                </button>
                <div class="dropdown-info">
                  <strong>üí° Tip:</strong> Upload to ChatGPT or Claude for AI-powered analysis of correlations and patterns!
                </div>
                <button id="copyPromptBtn" class="dropdown-item copy-prompt-btn">
                  <span class="dropdown-icon">üìù</span>
                  <span>Copy AI Prompt</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Summary Statistics Cards -->
      <section class="stats-section">
        <h2>Summary Statistics</h2>
        <div id="statsCards" class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-content">
              <div class="stat-label">Total Peak Views</div>
              <div class="stat-value" id="totalViews">-</div>
              <div class="stat-helper">Sum of daily peak views</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìà</div>
            <div class="stat-content">
              <div class="stat-label">Avg Daily Peak Views</div>
              <div class="stat-value" id="avgDailyViews">-</div>
              <div class="stat-helper">Average peak per day</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üî•</div>
            <div class="stat-content">
              <div class="stat-label">Peak View Day</div>
              <div class="stat-value" id="peakDay">-</div>
              <div class="stat-subtext" id="peakDayViews">-</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon trend-icon" id="trendIcon">‚û°Ô∏è</div>
            <div class="stat-content">
              <div class="stat-label">Trend</div>
              <div class="stat-value" id="trendValue">-</div>
              <div class="stat-subtext" id="trendPercent">-</div>
            </div>
          </div>
        </div>
      </section>

      <!-- View Toggle -->
      <section class="view-toggle-section">
        <div class="view-toggle-container">
          <label class="view-toggle-label">Chart View:</label>
          <div class="view-toggle-buttons">
            <button class="view-toggle-btn active" data-view="stacked" id="stackedViewBtn">
              <span class="toggle-icon">üìä</span>
              <span>Stacked View</span>
            </button>
            <button class="view-toggle-btn" data-view="overlay" id="overlayViewBtn">
              <span class="toggle-icon">üìà</span>
              <span>Overlay View</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Overlay Chart Section -->
      <section class="chart-section overlay-chart-section" id="overlayChartSection" style="display: none;">
        <h2>Sentiment Indicators Overlay</h2>
        <p class="section-description">All metrics overlaid on one chart for direct comparison - YouTube Views (Blue), Fear & Greed (Orange/Red), BTC Price (Green)</p>
        
        <div class="overlay-controls">
          <label class="overlay-checkbox">
            <input type="checkbox" id="showRsiOverlay">
            <span>Show RSI overlay</span>
          </label>
          <label class="overlay-checkbox">
            <input type="checkbox" id="normalizeOverlay">
            <span>Normalize to 0-100 scale</span>
          </label>
        </div>
        
        <div class="chart-container">
          <canvas id="overlayChart"></canvas>
        </div>
      </section>

      <!-- Main Chart -->
      <section class="chart-section" id="viewsChartSection">
        <h2>Live Stream Peak View Trends</h2>
        <p class="section-description">Peak view count from live streams per day. Days with multiple streams show the highest-viewed stream.</p>
        <div class="sentiment-indicators">
          <div class="sentiment-zone euphoria">
            <span class="zone-label">Euphoria Zone</span>
            <span class="zone-desc">High view activity - potential market top</span>
          </div>
          <div class="sentiment-zone fear">
            <span class="zone-label">Fear Zone</span>
            <span class="zone-desc">Low view activity - potential market bottom</span>
          </div>
        </div>
        <div class="chart-container">
          <div id="chartLoading" class="loading-state" style="display: none;">
            <div class="spinner"></div>
            <p>Loading chart data...</p>
          </div>
          <canvas id="viewsChart"></canvas>
        </div>
        <div id="chartLegend" class="chart-legend"></div>
      </section>

      <!-- RSI Chart Section -->
      <section class="chart-section rsi-section">
        <div class="rsi-header">
          <h2>RSI - Relative Strength Index</h2>
          <div class="rsi-controls">
            <div class="rsi-period-selector">
              <label for="rsiPeriod">RSI Period:</label>
              <select id="rsiPeriod">
                <option value="7">7 Days</option>
                <option value="14" selected>14 Days</option>
                <option value="21">21 Days</option>
              </select>
            </div>
            <div class="rsi-toggle">
              <label class="toggle-switch">
                <input type="checkbox" id="rsiToggle" checked>
                <span class="toggle-slider"></span>
              </label>
              <label for="rsiToggle">Show RSI</label>
            </div>
          </div>
        </div>
        <div class="rsi-description">
          <p>RSI measures sentiment momentum and "heat" from 0-100:</p>
          <div class="rsi-legend">
            <div class="rsi-legend-item overbought">
              <span class="rsi-indicator"></span>
              <span><strong>Above 70:</strong> Heated/Euphoric (Overbought)</span>
            </div>
            <div class="rsi-legend-item neutral">
              <span class="rsi-indicator"></span>
              <span><strong>30-70:</strong> Neutral Zone</span>
            </div>
            <div class="rsi-legend-item oversold">
              <span class="rsi-indicator"></span>
              <span><strong>Below 30:</strong> Cooling/Fear (Oversold)</span>
            </div>
          </div>
        </div>
        <div id="rsiChartContainer" class="chart-container rsi-chart-container">
          <canvas id="rsiChart"></canvas>
        </div>
      </section>

      <!-- BTC Price Chart Section -->
      <section class="chart-section btc-section">
        <h2>Bitcoin Price (USD)</h2>
        <p class="section-description">Daily BTC price movements to correlate with sentiment indicators</p>
        <div class="chart-container">
          <canvas id="btcChart"></canvas>
        </div>
      </section>

      <!-- Fear & Greed Index Chart Section -->
      <section class="chart-section fng-section">
        <h2>Crypto Fear & Greed Index</h2>
        <p class="section-description">Market sentiment index from Alternative.me (0-100 scale)</p>
        <div class="fng-legend">
          <div class="fng-legend-item extreme-fear">
            <span class="fng-indicator"></span>
            <span><strong>0-24:</strong> Extreme Fear</span>
          </div>
          <div class="fng-legend-item fear">
            <span class="fng-indicator"></span>
            <span><strong>25-49:</strong> Fear</span>
          </div>
          <div class="fng-legend-item greed">
            <span class="fng-indicator"></span>
            <span><strong>50-74:</strong> Greed</span>
          </div>
          <div class="fng-legend-item extreme-greed">
            <span class="fng-indicator"></span>
            <span><strong>75-100:</strong> Extreme Greed</span>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="fngChart"></canvas>
        </div>
      </section>

      <!-- No Data Message -->
      <div id="noDataMessage" class="no-data-message" style="display: none;">
        <div class="no-data-icon">üìä</div>
        <h3>No Data Available</h3>
        <p>Select channels and a date range, then click "Apply Filters" to view the data.</p>
      </div>
    </main>

    <footer>
      <p>&copy; 2024 YouTube Live Stream Sentiment Dashboard. Data for educational and analytical purposes.</p>
    </footer>
  </div>

  <script src="app.js"></script>
  <script src="overlay-functions.js"></script>
</body>
</html>
